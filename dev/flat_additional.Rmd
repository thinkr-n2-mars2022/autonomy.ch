---
title: "flat_additional.Rmd empty"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
library(assertthat)
library(dplyr)
```

```{r development-1}
# Load already included functions
pkgload::load_all(export_all = FALSE)
```

# Function check_data_integrity

```{r function-check_data_integrity}
#' check_data_integrity check dataset integrity
#'
#' @param data a dataset to check
#' @param colname a column to check
#' @return Side effect: a text message if everything is OK
#' @importFrom assertthat assert_that
#' @importFrom dplyr pull
#' @export
#'
#' @examples
check_data_integrity <- function(data, colname) {
  assert_that(is.data.frame(data))
  assert_that({{colname}} %in% names(data))
  
  detect_str <- data %>% pull({colname}) %>% 
    stringr::str_detect('\\+')
  assert_that(!any(detect_str, na.rm = T))
  return("Dataset is OK")
}
```

```{r examples-check_data_integrity}
datafile <- system.file("nyc_squirrels_sample.csv", package = "autonomy.ch")
nyc_squirrels <- read.csv(datafile)

check_data_integrity(nyc_squirrels,'primary_fur_color')
#check_data_integrity(nyc_squirrels,'combination_of_primary_and_highlight_color')
```

```{r tests-check_data_integrity}
test_that("check_data_integrity works", {
  datafile <- system.file("nyc_squirrels_sample.csv", package = "autonomy.ch")
  nyc_squirrels <- read.csv(datafile)
  colname = 'combination_of_primary_and_highlight_color'
  
  testthat::expect_error(check_data_integrity(NULL, colname))
  testthat::expect_error(check_data_integrity(nyc_squirrels, colname))

})
```


```{r development-inflate, eval=FALSE}
# Run but keep eval=FALSE to avoid infinite loop
# Execute in the console directly
fusen::inflate(flat_file = "dev/flat_additional.Rmd", vignette_name = "Go further")
```

